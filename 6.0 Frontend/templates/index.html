<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EhkoForge</title>
    
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/recog.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=VT323&display=swap" rel="stylesheet">
</head>
<body>
    <!-- CRT Overlay Effect -->
    <div class="crt-overlay"></div>
    
    <!-- Main Container -->
    <div class="terminal-container">
        
        <!-- Header Bar -->
        <header class="header-bar">
            <!-- Brand -->
            <div class="header-brand">
                <div class="brand-logo">
                    <span class="brand-icon">⚒</span>
                </div>
                <div class="brand-text">
                    <span class="brand-name">EHKOFORGE</span>
                    <span class="brand-version">v2.0</span>
                </div>
            </div>
            
            <!-- Mode Dial - Retro Toggle -->
            <div class="mode-dial-container">
                <div class="dial-track">
                    <span class="dial-label dial-label-terminal" data-mode="terminal">TERMINAL</span>
                    <div class="dial-channel">
                        <div class="dial-knob" id="dial-knob">
                            <div class="knob-grip"></div>
                            <div class="knob-grip"></div>
                            <div class="knob-grip"></div>
                        </div>
                    </div>
                    <span class="dial-label dial-label-reflect" data-mode="reflection">REFLECT</span>
                </div>
                <div class="dial-indicators">
                    <span class="dial-led active" id="led-terminal"></span>
                    <span class="dial-led" id="led-reflect"></span>
                </div>
            </div>
            
            <!-- Model Selector -->
            <div class="model-selector">
                <div class="model-dropdown" id="model-dropdown">
                    <button class="model-dropdown-trigger" id="model-trigger">
                        <span class="model-name" id="selected-model-name">Claude Sonnet 4</span>
                        <span class="model-trigger-cost" id="selected-model-cost">◆1</span>
                        <span class="dropdown-arrow">▾</span>
                    </button>
                    <div class="model-dropdown-menu" id="model-menu">
                        <div class="model-option" data-model="claude-sonnet-4" data-cost-terminal="1" data-cost-reflection="3">
                            <span class="option-name">Claude Sonnet 4</span>
                            <span class="option-cost"></span>
                        </div>
                        <div class="model-option" data-model="claude-opus-4" data-cost-terminal="2" data-cost-reflection="6">
                            <span class="option-name">Claude Opus 4</span>
                            <span class="option-cost"></span>
                        </div>
                        <div class="model-option" data-model="claude-haiku-4" data-cost-terminal="0.5" data-cost-reflection="1.5">
                            <span class="option-name">Claude Haiku 4</span>
                            <span class="option-cost"></span>
                        </div>
                        <div class="model-option" data-model="gpt-4o" data-cost-terminal="1.5" data-cost-reflection="4">
                            <span class="option-name">GPT-4o</span>
                            <span class="option-cost"></span>
                        </div>
                        <div class="model-option" data-model="gpt-4o-mini" data-cost-terminal="0.3" data-cost-reflection="1">
                            <span class="option-name">GPT-4o mini</span>
                            <span class="option-cost"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <button class="recog-link" id="recog-btn" title="ReCog Engine">
                    <span class="recog-icon">⚙</span>
                    <span class="recog-label">ReCog</span>
                    <span class="recog-badge" id="recog-badge" style="display: none;">0</span>
                </button>
                <a href="/forge" class="forge-link" title="Review Insites">
                    <span class="forge-icon">⚡</span>
                    <span class="forge-label">Forge</span>
                    <span class="insite-badge" id="insite-badge" style="display: none;">0</span>
                </a>
                <button class="settings-btn" id="settings-btn" title="Settings">⚙</button>
            </div>
        </header>
        
        <!-- Status Bar (Authority + ASCII Logo + Mana) -->
        <div class="status-bar">
            <!-- Authority Progress -->
            <div class="authority-section">
                <div class="authority-header">
                    <span class="authority-label">AUTHORITY</span>
                    <span class="authority-value" id="authority-total">0%</span>
                    <span class="authority-stage" id="authority-stage">Nascent</span>
                </div>
                <div class="authority-bars">
                    <div class="authority-bar" data-component="memory_depth" title="Memory Depth">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">MEM</span>
                    </div>
                    <div class="authority-bar" data-component="identity_clarity" title="Identity Clarity">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">IDN</span>
                    </div>
                    <div class="authority-bar" data-component="emotional_range" title="Emotional Range">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">EMO</span>
                    </div>
                    <div class="authority-bar" data-component="temporal_coverage" title="Temporal Coverage">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">TMP</span>
                    </div>
                    <div class="authority-bar" data-component="core_density" title="Core Density">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">COR</span>
                    </div>
                </div>
            </div>
            
            <!-- ASCII EHKO Logo (center) -->
            <div class="ascii-logo-section" id="ascii-section">
                <pre class="ascii-logo" id="ascii-display"></pre>
            </div>
            
            <!-- Mana Display -->
            <div class="mana-section">
                <ehko-mana-bar 
                    id="mana-bar"
                    current="100" 
                    regen="100" 
                    purchased="0"
                    show-breakdown="true">
                </ehko-mana-bar>
                
                <!-- LLM Tether System (Web Components) -->
                <div class="tethers-section" id="tethers-section">
                    <div class="tethers-header">
                        <span class="tethers-label">TETHERS</span>
                        <button class="tethers-manage-btn" id="tethers-manage-btn" title="Manage Tethers">⚙</button>
                    </div>
                    <div class="tethers-list" id="tethers-list">
                        <!-- Populated by JS with <ehko-tether-bar> components -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Avatar Zone -->
        <div class="avatar-zone" id="avatar-zone">
            <!-- Terminal header -->
            <div class="terminal-header">
                <span class="terminal-label">◆ EHKO DISPLAY</span>
                <span class="terminal-version">v2.0</span>
            </div>
            
            <!-- Monitor screen wrapper -->
            <div class="monitor-screen">
                <!-- Full-width matrix code background -->
                <canvas class="matrix-code-bg" id="matrix-canvas" width="1200" height="120"></canvas>
            
                <!-- Single Avatar -->
                <div class="avatar" id="avatar">
                    <svg class="avatar-form" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
                        <rect class="monitor-body" x="12" y="18" width="56" height="48" rx="4" />
                        <rect class="screen-bezel" x="18" y="24" width="44" height="32" rx="2" />
                        <line class="antenna" x1="20" y1="18" x2="18" y2="10" />
                        <circle class="antenna-tip" cx="18" cy="10" r="1.5" />
                        <line class="antenna" x1="60" y1="18" x2="62" y2="10" />
                        <circle class="antenna-tip" cx="62" cy="10" r="1.5" />
                        <line class="vent-line" x1="14" y1="30" x2="16" y2="30" />
                        <line class="vent-line" x1="14" y1="34" x2="16" y2="34" />
                        <line class="vent-line" x1="14" y1="38" x2="16" y2="38" />
                        <line class="vent-line" x1="64" y1="30" x2="66" y2="30" />
                        <line class="vent-line" x1="64" y1="34" x2="66" y2="34" />
                        <line class="vent-line" x1="64" y1="38" x2="66" y2="38" />
                        <rect class="monitor-stand" x="32" y="66" width="16" height="4" rx="1" />
                        <rect class="monitor-base" x="28" y="70" width="24" height="3" rx="1" />
                        <rect class="screen-glow" x="20" y="26" width="40" height="28" rx="1" />
                    </svg>
                    <div class="avatar-eyes">
                        <div class="eye eye-left"></div>
                        <div class="eye eye-right"></div>
                    </div>
                </div>
            </div>
            <div class="avatar-status" id="avatar-status">Ready</div>
        </div>
        
        <!-- Terminal Output -->
        <div class="terminal-output" id="terminal-output">
            <div class="welcome-message">
                <p class="welcome-text" id="welcome-text">
                    > TERMINAL MODE — Your Ehko awaits.
                </p>
            </div>
        </div>
        
        <!-- Input Bar -->
        <div class="input-bar">
            <span class="input-prompt" id="input-prompt">&gt;</span>
            <textarea 
                id="message-input" 
                placeholder="Type a message..."
                rows="1"
            ></textarea>
            <div class="input-cost" id="input-cost" title="Mana cost">
                <span class="cost-icon">◆</span>
                <span class="cost-value">1</span>
            </div>
            <button class="send-btn" id="send-btn" title="Send (Enter)">↵</button>
        </div>
        
        <!-- Session Controls -->
        <div class="session-bar">
            <div class="session-info">
                <span class="session-label">Session:</span>
                <span class="session-title" id="session-title">New Chat</span>
            </div>
            <div class="session-actions">
                <button class="session-btn" id="new-session-btn" title="New Session">+</button>
                <button class="session-btn" id="forge-session-btn" title="Forge to Vault">⚡</button>
                <button class="session-btn" id="history-btn" title="Session History">☰</button>
            </div>
        </div>
    </div>
    
    <!-- Session History Drawer -->
    <div class="drawer-overlay" id="history-overlay">
        <div class="drawer history-drawer">
            <div class="drawer-header">
                <h2>Session History</h2>
                <button class="drawer-close" id="history-close">×</button>
            </div>
            <div class="drawer-content" id="session-list">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>
    
    <!-- Settings Drawer -->
    <div class="drawer-overlay" id="settings-overlay">
        <div class="drawer settings-drawer">
            <div class="drawer-header">
                <h2>Settings</h2>
                <button class="drawer-close" id="settings-close">×</button>
            </div>
            <div class="drawer-content">
                <!-- LLM Tethers -->
                <div class="setting-group">
                    <label class="setting-label">LLM Tethers</label>
                    <p class="setting-description">Connect your own API keys to bypass mana consumption. Tethers provide unlimited access to LLM providers.</p>
                    <button class="setting-action" id="open-tether-panel">⚡ Manage Tethers</button>
                </div>
                
                <!-- Display Settings -->
                <div class="setting-group">
                    <label class="setting-label">Display</label>
                    <div class="setting-item">
                        <input type="checkbox" id="setting-avatar" checked>
                        <label for="setting-avatar">Show Avatar Zone</label>
                    </div>
                    <div class="setting-item">
                        <input type="checkbox" id="setting-scanlines" checked>
                        <label for="setting-scanlines">CRT Scanline Effect</label>
                    </div>
                    <div class="setting-item">
                        <input type="checkbox" id="setting-motion">
                        <label for="setting-motion">Reduce Motion</label>
                    </div>
                    <div class="setting-item">
                        <input type="checkbox" id="setting-ascii-logo" checked>
                        <label for="setting-ascii-logo">Show ASCII Logo</label>
                    </div>
                </div>
                
                <!-- Data & Privacy -->
                <div class="setting-group">
                    <label class="setting-label">Data & Privacy</label>
                    <p class="setting-description">Your data is stored locally. API keys are encrypted and never leave your device.</p>
                    <button class="setting-action setting-secondary" id="export-data">Export My Data</button>
                    <button class="setting-action setting-danger" id="clear-all-data">Clear All Local Data</button>
                </div>
                
                <!-- Debug -->
                <div class="setting-group">
                    <label class="setting-label">Debug</label>
                    <button class="setting-action" id="refresh-authority">Recalculate Authority</button>
                    <button class="setting-action" id="refresh-tethers">Refresh Tether Status</button>
                    <button class="setting-action" id="view-usage-history">View Usage History</button>
                </div>
                
                <!-- About -->
                <div class="setting-group">
                    <label class="setting-label">About</label>
                    <div class="about-info">
                        <p><strong>EhkoForge</strong> v2.0</p>
                        <p class="about-tagline">Digital identity preservation system</p>
                        <p class="about-links">
                            <a href="https://ehkoforge.ai" target="_blank">Website</a> · 
                            <a href="https://github.com/ehkoforge" target="_blank">GitHub</a> · 
                            <a href="mailto:support@ehkoforge.ai">Support</a>
                        </p>
                        <p class="about-license">Licensed under AGPLv3</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Forge Modal -->
    <div class="modal-overlay" id="forge-overlay">
        <div class="modal forge-modal">
            <div class="modal-header">
                <h2>Forge to Vault</h2>
                <button class="modal-close" id="forge-close">×</button>
            </div>
            <div class="modal-content">
                <div class="forge-field">
                    <label for="forge-title">Title</label>
                    <input type="text" id="forge-title" placeholder="Reflection title...">
                </div>
                <div class="forge-field">
                    <label for="forge-tags">Tags (comma-separated)</label>
                    <input type="text" id="forge-tags" placeholder="identity, values, growth...">
                </div>
                <div class="forge-field">
                    <label for="forge-emotional">Emotional Tags</label>
                    <input type="text" id="forge-emotional" placeholder="hopeful, anxious, curious...">
                </div>
                <div class="forge-preview">
                    <span class="preview-count" id="forge-count">0 messages selected</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-cancel" id="forge-cancel">Cancel</button>
                <button class="modal-confirm" id="forge-confirm">Forge</button>
            </div>
        </div>
    </div>
    
    <!-- Dormant Modal -->
    <div class="modal-overlay" id="dormant-overlay">
        <div class="modal dormant-modal">
            <div class="modal-header">
                <h2>Ehko is Resting</h2>
            </div>
            <div class="modal-content">
                <div class="dormant-icon">◇</div>
                <p class="dormant-message" id="dormant-message">
                    My mana has been depleted. I need time to recover.
                </p>
                <div class="dormant-stats">
                    <span>Current: <strong id="dormant-current">0</strong></span>
                    <span>Required: <strong id="dormant-required">1</strong></span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-confirm" id="dormant-ok">Understood</button>
            </div>
        </div>
    </div>

    <!-- Mana Purchase Modal -->
    <div class="modal-overlay" id="purchase-overlay">
        <div class="modal purchase-modal">
            <div class="modal-header">
                <h2>Purchase Mana-Cores</h2>
                <button class="modal-close" id="purchase-close">×</button>
            </div>
            <div class="modal-content">
                <p class="purchase-info">Top up your mana to continue reflecting and journaling. No subscriptions, no expiry.</p>
                <div class="pricing-tiers" id="pricing-tiers">
                    <!-- Populated by JS -->
                </div>
                <div class="purchase-note">
                    <p><strong>Note:</strong> This is a simulated purchase for MVP testing. Actual Stripe integration coming Q1 2026.</p>
                    <p>Questions? Contact <a href="mailto:licensing@ehkoforge.ai">licensing@ehkoforge.ai</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Usage History Modal -->
    <div class="modal-overlay" id="usage-overlay">
        <div class="modal usage-modal">
            <div class="modal-header">
                <h2>Mana Usage History</h2>
                <button class="modal-close" id="usage-close">×</button>
            </div>
            <div class="modal-content">
                <div class="usage-tabs">
                    <button class="usage-tab active" data-tab="purchases">Purchases</button>
                    <button class="usage-tab" data-tab="usage">Usage Stats</button>
                </div>
                <div class="usage-tab-content">
                    <div class="usage-pane active" id="purchases-pane">
                        <div class="purchase-history" id="purchase-history">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="usage-pane" id="usage-pane">
                        <div class="usage-stats" id="usage-stats">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ReCog Drawer -->
    <div class="drawer-overlay" id="recog-overlay">
        <div class="drawer recog-drawer">
            <div class="drawer-header">
                <h2>ReCog Engine</h2>
                <button class="drawer-close" id="recog-close">×</button>
            </div>
            
            <!-- Tabs -->
            <div class="recog-tabs">
                <button class="recog-tab active" data-tab="queue">Queue</button>
                <button class="recog-tab" data-tab="reports">Reports</button>
                <button class="recog-tab" data-tab="progression">Progression</button>
            </div>
            
            <!-- Queue Pane -->
            <div class="recog-pane active" id="recog-pane-queue">
                <!-- Status Card -->
                <div class="recog-status-card">
                    <div class="recog-status-header">
                        <span class="recog-status-title">Engine Status</span>
                        <div class="recog-status-indicator">
                            <span class="recog-status-dot" id="recog-status-dot"></span>
                            <span id="recog-status-text">Checking...</span>
                        </div>
                    </div>
                    <div class="recog-stats">
                        <div class="recog-stat">
                            <div class="recog-stat-value" id="stat-hot">0</div>
                            <div class="recog-stat-label">Hot Sessions</div>
                        </div>
                        <div class="recog-stat">
                            <div class="recog-stat-value" id="stat-insights">0</div>
                            <div class="recog-stat-label">Pending Insights</div>
                        </div>
                        <div class="recog-stat">
                            <div class="recog-stat-value" id="stat-patterns">0</div>
                            <div class="recog-stat-label">Patterns</div>
                        </div>
                    </div>
                </div>
                
                <!-- Pending Operations -->
                <div class="pending-operations">
                    <div class="pending-header">
                        <span class="pending-title">Pending Operations</span>
                        <button class="pending-check-btn" id="recog-check-btn">Check Now</button>
                    </div>
                    <div class="pending-list" id="pending-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
            
            <!-- Reports Pane -->
            <div class="recog-pane" id="recog-pane-reports">
                <div class="reports-list" id="reports-list">
                    <!-- Populated by JS -->
                </div>
            </div>
            
            <!-- Progression Pane -->
            <div class="recog-pane" id="recog-pane-progression">
                <div class="progression-card">
                    <div class="progression-stage" id="progression-stage">Nascent</div>
                    <div class="progression-entered" id="progression-entered"></div>
                    
                    <div class="progression-pillars" id="pillars-list">
                        <!-- Populated by JS -->
                    </div>
                    
                    <div class="progression-stats">
                        <div class="progression-stat">
                            <div class="progression-stat-value" id="core-memory-count">0</div>
                            <div class="progression-stat-label">Core Memories</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Process Button -->
            <div class="process-section">
                <button class="process-btn" id="recog-process-btn" disabled>
                    <span>▶</span>
                    <span>Process Confirmed (<span id="confirmed-count">0</span>)</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ReCog Processing Overlay -->
    <div class="processing-overlay" id="processing-overlay">
        <div class="processing-animation">
            <div class="processing-ring"></div>
            <div class="processing-ring"></div>
            <div class="processing-ring"></div>
            <div class="processing-core"></div>
        </div>
        <div class="processing-text" id="processing-text">Processing...</div>
        <div class="processing-subtext" id="processing-subtext"></div>
    </div>

    <!-- ReCog Toast -->
    <div class="recog-toast" id="recog-toast"></div>

    <!-- Tether Management Panel (Web Component) -->
    <ehko-tether-panel id="tether-panel"></ehko-tether-panel>

    <script src="/js/main.js"></script>
    <script src="/js/recog.js"></script>
    <script src="/components/ehko-toast.js"></script>
    <script src="/components/ehko-mana-bar.js"></script>
    <script src="/components/ehko-tether-bar.js"></script>
    <script src="/components/ehko-tether-panel.js"></script>
</body>
</html>
