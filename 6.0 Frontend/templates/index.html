<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EhkoForge</title>
    
    <link rel="stylesheet" href="/css/main.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=VT323&display=swap" rel="stylesheet">
</head>
<body>
    <!-- CRT Overlay Effect -->
    <div class="crt-overlay"></div>
    
    <!-- Main Container -->
    <div class="terminal-container">
        
        <!-- Header Bar -->
        <header class="header-bar">
            <div class="header-left">
                <span class="logo">◈ EHKOFORGE</span>
                <span class="version">v2.0</span>
            </div>
            
            <!-- Mode Toggle -->
            <div class="mode-toggle">
                <button class="mode-btn active" data-mode="terminal" title="Terminal Mode (1 mana/msg)">
                    <span class="mode-icon">⌘</span>
                    <span class="mode-label">Terminal</span>
                </button>
                <button class="mode-btn" data-mode="reflection" title="Reflection Mode (3 mana/msg)">
                    <span class="mode-icon">◎</span>
                    <span class="mode-label">Reflect</span>
                </button>
            </div>
            
            <!-- Model Selector -->
            <div class="model-selector">
                <div class="model-dropdown" id="model-dropdown">
                    <button class="model-dropdown-trigger" id="model-trigger">
                        <span class="model-name" id="selected-model-name">Claude Sonnet 4</span>
                        <span class="model-trigger-cost" id="selected-model-cost">◆1</span>
                        <span class="dropdown-arrow">▾</span>
                    </button>
                    <div class="model-dropdown-menu" id="model-menu">
                        <div class="model-option" data-model="claude-sonnet-4" data-cost-terminal="1" data-cost-reflection="3">
                            <span class="option-name">Claude Sonnet 4</span>
                            <span class="option-cost"></span>
                        </div>
                        <div class="model-option" data-model="claude-opus-4" data-cost-terminal="2" data-cost-reflection="6">
                            <span class="option-name">Claude Opus 4</span>
                            <span class="option-cost"></span>
                        </div>
                        <div class="model-option" data-model="claude-haiku-4" data-cost-terminal="0.5" data-cost-reflection="1.5">
                            <span class="option-name">Claude Haiku 4</span>
                            <span class="option-cost"></span>
                        </div>
                        <div class="model-option" data-model="gpt-4o" data-cost-terminal="1.5" data-cost-reflection="4">
                            <span class="option-name">GPT-4o</span>
                            <span class="option-cost"></span>
                        </div>
                        <div class="model-option" data-model="gpt-4o-mini" data-cost-terminal="0.3" data-cost-reflection="1">
                            <span class="option-name">GPT-4o mini</span>
                            <span class="option-cost"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <a href="/forge" class="forge-link" title="Review Insites">
                    <span class="forge-icon">⚡</span>
                    <span class="forge-label">Forge</span>
                    <span class="insite-badge" id="insite-badge" style="display: none;">0</span>
                </a>
                <button class="settings-btn" id="settings-btn" title="Settings">⚙</button>
            </div>
        </header>
        
        <!-- Status Bar (Authority + Mana) -->
        <div class="status-bar">
            <!-- Authority Progress -->
            <div class="authority-section">
                <div class="authority-header">
                    <span class="authority-label">AUTHORITY</span>
                    <span class="authority-value" id="authority-total">0%</span>
                    <span class="authority-stage" id="authority-stage">Nascent</span>
                </div>
                <div class="authority-bars">
                    <div class="authority-bar" data-component="memory_depth" title="Memory Depth">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">MEM</span>
                    </div>
                    <div class="authority-bar" data-component="identity_clarity" title="Identity Clarity">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">IDN</span>
                    </div>
                    <div class="authority-bar" data-component="emotional_range" title="Emotional Range">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">EMO</span>
                    </div>
                    <div class="authority-bar" data-component="temporal_coverage" title="Temporal Coverage">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">TMP</span>
                    </div>
                    <div class="authority-bar" data-component="core_density" title="Core Density">
                        <div class="bar-fill" style="width: 0%"></div>
                        <span class="bar-label">COR</span>
                    </div>
                </div>
            </div>
            
            <!-- Mana Display -->
            <div class="mana-section">
                <div class="mana-display">
                    <span class="mana-icon">◆</span>
                    <span class="mana-value" id="mana-current">100</span>
                    <span class="mana-separator">/</span>
                    <span class="mana-max" id="mana-max">100</span>
                    <button class="mana-topup-btn" id="mana-topup-btn" title="Purchase Mana-Cores">▲</button>
                </div>
                <div class="mana-bar">
                    <div class="mana-fill" id="mana-fill" style="width: 100%"></div>
                    <div class="mana-fill-purchased" id="mana-fill-purchased" style="width: 0%"></div>
                </div>
                <div class="mana-breakdown" id="mana-breakdown">
                    <span class="mana-regen" id="mana-regen" title="Regenerative (BYOK)">Regen: 100</span>
                    <span class="mana-purchased" id="mana-purchased" title="Purchased">Bought: 0</span>
                </div>
            </div>
        </div>
        
        <!-- Avatar Zone -->
        <div class="avatar-zone" id="avatar-zone">
            <!-- Terminal header -->
            <div class="terminal-header">
                <span class="terminal-label">◆ EHKO DISPLAY</span>
                <span class="terminal-version">v2.0</span>
            </div>
            
            <!-- Monitor screen wrapper -->
            <div class="monitor-screen">
                <!-- Full-width matrix code background -->
                <canvas class="matrix-code-bg" id="matrix-canvas" width="1200" height="120"></canvas>
            
                <!-- Avatar Carousel -->
                <div class="avatar-carousel" id="avatar-carousel">
                    <!-- Form 1: The Classic (Retro Monitor) -->
                    <div class="avatar-form-container active" data-form="classic">
                        <div class="avatar" id="avatar">
                            <svg class="avatar-form" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
                                <rect class="monitor-body" x="12" y="18" width="56" height="48" rx="4" />
                                <rect class="screen-bezel" x="18" y="24" width="44" height="32" rx="2" />
                                <line class="antenna" x1="20" y1="18" x2="18" y2="10" />
                                <circle class="antenna-tip" cx="18" cy="10" r="1.5" />
                                <line class="antenna" x1="60" y1="18" x2="62" y2="10" />
                                <circle class="antenna-tip" cx="62" cy="10" r="1.5" />
                                <line class="vent-line" x1="14" y1="30" x2="16" y2="30" />
                                <line class="vent-line" x1="14" y1="34" x2="16" y2="34" />
                                <line class="vent-line" x1="14" y1="38" x2="16" y2="38" />
                                <line class="vent-line" x1="64" y1="30" x2="66" y2="30" />
                                <line class="vent-line" x1="64" y1="34" x2="66" y2="34" />
                                <line class="vent-line" x1="64" y1="38" x2="66" y2="38" />
                                <rect class="monitor-stand" x="32" y="66" width="16" height="4" rx="1" />
                                <rect class="monitor-base" x="28" y="70" width="24" height="3" rx="1" />
                                <rect class="screen-glow" x="20" y="26" width="40" height="28" rx="1" />
                            </svg>
                            <div class="avatar-eyes">
                                <div class="eye eye-left"></div>
                                <div class="eye eye-right"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Form 2: The Nascent Core -->
                    <div class="avatar-form-container" data-form="core">
                        <div class="avatar">
                            <svg class="avatar-form" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="40" cy="40" r="32" fill="none" stroke="var(--accent-primary)" stroke-width="0.5" opacity="0.3">
                                    <animateTransform attributeName="transform" type="rotate" from="0 40 40" to="360 40 40" dur="20s" repeatCount="indefinite"/>
                                </circle>
                                <path d="M40 15 A25 25 0 0 1 65 40 M40 65 A25 25 0 0 1 15 40" fill="none" stroke="var(--accent-primary)" stroke-width="1" opacity="0.5">
                                    <animateTransform attributeName="transform" type="rotate" from="360 40 40" to="0 40 40" dur="10s" repeatCount="indefinite"/>
                                </path>
                                <rect x="30" y="30" width="20" height="20" fill="none" stroke="var(--accent-primary)" stroke-width="1.5" transform="rotate(45 40 40)">
                                    <animate attributeName="opacity" values="0.4;1;0.4" dur="4s" repeatCount="indefinite"/>
                                </rect>
                                <circle cx="40" cy="40" r="4" fill="var(--accent-primary)">
                                    <animate attributeName="r" values="3;5;3" dur="2s" repeatCount="indefinite"/>
                                    <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/>
                                </circle>
                            </svg>
                        </div>
                    </div>

                    <!-- Form 3: The Construct -->
                    <div class="avatar-form-container" data-form="construct">
                        <div class="avatar">
                            <svg class="avatar-form" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20,25 L60,25 L65,35 L65,60 L55,65 L25,65 L15,60 L15,35 Z" fill="none" stroke="var(--accent-primary)" stroke-width="1.5" />
                                <line x1="15" y1="35" x2="65" y2="35" stroke="var(--accent-primary)" stroke-width="1" opacity="0.5" />
                                <rect x="25" y="40" width="30" height="8" rx="2" fill="var(--accent-primary)" opacity="0.2" />
                                <rect x="25" y="40" width="30" height="8" rx="2" fill="none" stroke="var(--accent-primary)" stroke-width="1">
                                    <animate attributeName="opacity" values="0.5;1;0.5" dur="3s" repeatCount="indefinite"/>
                                </rect>
                                <line x1="10" y1="45" x2="15" y2="45" stroke="var(--accent-primary)" stroke-width="1" />
                                <line x1="65" y1="45" x2="70" y2="45" stroke="var(--accent-primary)" stroke-width="1" />
                                <path d="M30,58 L50,58" stroke="var(--accent-primary)" stroke-width="1" stroke-dasharray="2 2" />
                            </svg>
                        </div>
                    </div>

                    <!-- Form 4: The Resonant -->
                    <div class="avatar-form-container" data-form="resonant">
                        <div class="avatar">
                            <svg class="avatar-form" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
                                <path d="M10,40 Q25,20 40,40 T70,40" fill="none" stroke="var(--accent-primary)" stroke-width="1" opacity="0.4">
                                    <animate attributeName="d" values="M10,40 Q25,20 40,40 T70,40; M10,40 Q25,60 40,40 T70,40; M10,40 Q25,20 40,40 T70,40" dur="4s" repeatCount="indefinite"/>
                                </path>
                                <path d="M10,40 Q25,60 40,40 T70,40" fill="none" stroke="var(--accent-primary)" stroke-width="1" opacity="0.4">
                                    <animate attributeName="d" values="M10,40 Q25,60 40,40 T70,40; M10,40 Q25,20 40,40 T70,40; M10,40 Q25,60 40,40 T70,40" dur="4s" repeatCount="indefinite"/>
                                </path>
                                <circle cx="40" cy="40" r="25" fill="none" stroke="var(--accent-primary)" stroke-width="0.5" stroke-dasharray="4 4" opacity="0.3">
                                    <animateTransform attributeName="transform" type="rotate" from="0 40 40" to="-360 40 40" dur="30s" repeatCount="indefinite"/>
                                </circle>
                                <circle cx="40" cy="40" r="2" fill="var(--accent-primary)" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
            <div class="avatar-status" id="avatar-status">Ready</div>
        </div>
        
        <!-- Terminal Output -->
        <div class="terminal-output" id="terminal-output">
            <div class="welcome-message">
                <pre class="ascii-art">
╔═══════════════════════════════════════════════════════════════╗
║  ███████╗██╗  ██╗██╗  ██╗ ██████╗                             ║
║  ██╔════╝██║  ██║██║ ██╔╝██╔═══██╗                            ║
║  █████╗  ███████║█████╔╝ ██║   ██║                            ║
║  ██╔══╝  ██╔══██║██╔═██╗ ██║   ██║                            ║
║  ███████╗██║  ██║██║  ██╗╚██████╔╝                            ║
║  ╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝                             ║
╚═══════════════════════════════════════════════════════════════╝
                </pre>
                <p class="welcome-text" id="welcome-text">
                    > TERMINAL MODE — Your Ehko awaits.
                </p>
            </div>
        </div>
        
        <!-- Input Bar -->
        <div class="input-bar">
            <span class="input-prompt" id="input-prompt">&gt;</span>
            <textarea 
                id="message-input" 
                placeholder="Type a message..."
                rows="1"
            ></textarea>
            <div class="input-cost" id="input-cost" title="Mana cost">
                <span class="cost-icon">◆</span>
                <span class="cost-value">1</span>
            </div>
            <button class="send-btn" id="send-btn" title="Send (Enter)">↵</button>
        </div>
        
        <!-- Session Controls -->
        <div class="session-bar">
            <div class="session-info">
                <span class="session-label">Session:</span>
                <span class="session-title" id="session-title">New Chat</span>
            </div>
            <div class="session-actions">
                <button class="session-btn" id="new-session-btn" title="New Session">+</button>
                <button class="session-btn" id="forge-session-btn" title="Forge to Vault">⚡</button>
                <button class="session-btn" id="history-btn" title="Session History">☰</button>
            </div>
        </div>
    </div>
    
    <!-- Session History Drawer -->
    <div class="drawer-overlay" id="history-overlay">
        <div class="drawer history-drawer">
            <div class="drawer-header">
                <h2>Session History</h2>
                <button class="drawer-close" id="history-close">×</button>
            </div>
            <div class="drawer-content" id="session-list">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>
    
    <!-- Settings Drawer -->
    <div class="drawer-overlay" id="settings-overlay">
        <div class="drawer settings-drawer">
            <div class="drawer-header">
                <h2>Settings</h2>
                <button class="drawer-close" id="settings-close">×</button>
            </div>
            <div class="drawer-content">
                <div class="setting-group">
                    <label class="setting-label">Mana Configuration</label>
                    <div class="setting-item">
                        <label for="mana-mode">Mode:</label>
                        <select id="mana-mode" class="setting-select">
                            <option value="mana">Mana (Purchase mana-cores)</option>
                            <option value="byok">BYOK (Bring your own keys)</option>
                            <option value="hybrid">Hybrid (Mix both)</option>
                        </select>
                    </div>
                    <div class="setting-item byok-config" style="display: none;">
                        <label for="byok-max-mana">BYOK Max Mana:</label>
                        <input type="number" id="byok-max-mana" class="setting-input" value="100" min="10" max="1000">
                    </div>
                    <div class="setting-item byok-config" style="display: none;">
                        <label for="byok-regen-rate">Regen Rate (per hour):</label>
                        <input type="number" id="byok-regen-rate" class="setting-input" value="1.0" min="0.1" max="10" step="0.1">
                    </div>
                    <button class="setting-action" id="save-mana-config">Save Mana Config</button>
                    <button class="setting-action" id="view-usage-history">View Usage History</button>
                </div>
                <div class="setting-group">
                    <label class="setting-label">Display</label>
                    <div class="setting-item">
                        <input type="checkbox" id="setting-avatar" checked>
                        <label for="setting-avatar">Show Avatar</label>
                    </div>
                    <div class="setting-item">
                        <input type="checkbox" id="setting-scanlines" checked>
                        <label for="setting-scanlines">Scanline Effect</label>
                    </div>
                    <div class="setting-item">
                        <input type="checkbox" id="setting-motion">
                        <label for="setting-motion">Reduce Motion</label>
                    </div>
                </div>
                <div class="setting-group">
                    <label class="setting-label">Debug</label>
                    <button class="setting-action" id="refresh-authority">Recalculate Authority</button>
                    <button class="setting-action" id="refill-mana">Refill Mana (BYOK)</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Forge Modal -->
    <div class="modal-overlay" id="forge-overlay">
        <div class="modal forge-modal">
            <div class="modal-header">
                <h2>Forge to Vault</h2>
                <button class="modal-close" id="forge-close">×</button>
            </div>
            <div class="modal-content">
                <div class="forge-field">
                    <label for="forge-title">Title</label>
                    <input type="text" id="forge-title" placeholder="Reflection title...">
                </div>
                <div class="forge-field">
                    <label for="forge-tags">Tags (comma-separated)</label>
                    <input type="text" id="forge-tags" placeholder="identity, values, growth...">
                </div>
                <div class="forge-field">
                    <label for="forge-emotional">Emotional Tags</label>
                    <input type="text" id="forge-emotional" placeholder="hopeful, anxious, curious...">
                </div>
                <div class="forge-preview">
                    <span class="preview-count" id="forge-count">0 messages selected</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-cancel" id="forge-cancel">Cancel</button>
                <button class="modal-confirm" id="forge-confirm">Forge</button>
            </div>
        </div>
    </div>
    
    <!-- Dormant Modal -->
    <div class="modal-overlay" id="dormant-overlay">
        <div class="modal dormant-modal">
            <div class="modal-header">
                <h2>Ehko is Resting</h2>
            </div>
            <div class="modal-content">
                <div class="dormant-icon">◇</div>
                <p class="dormant-message" id="dormant-message">
                    My mana has been depleted. I need time to recover.
                </p>
                <div class="dormant-stats">
                    <span>Current: <strong id="dormant-current">0</strong></span>
                    <span>Required: <strong id="dormant-required">1</strong></span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-confirm" id="dormant-ok">Understood</button>
            </div>
        </div>
    </div>

    <!-- Mana Purchase Modal -->
    <div class="modal-overlay" id="purchase-overlay">
        <div class="modal purchase-modal">
            <div class="modal-header">
                <h2>Purchase Mana-Cores</h2>
                <button class="modal-close" id="purchase-close">×</button>
            </div>
            <div class="modal-content">
                <p class="purchase-info">Top up your mana to continue reflecting and journaling. No subscriptions, no expiry.</p>
                <div class="pricing-tiers" id="pricing-tiers">
                    <!-- Populated by JS -->
                </div>
                <div class="purchase-note">
                    <p><strong>Note:</strong> This is a simulated purchase for MVP testing. Actual Stripe integration coming Q1 2026.</p>
                    <p>Questions? Contact <a href="mailto:licensing@ehkoforge.ai">licensing@ehkoforge.ai</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Usage History Modal -->
    <div class="modal-overlay" id="usage-overlay">
        <div class="modal usage-modal">
            <div class="modal-header">
                <h2>Mana Usage History</h2>
                <button class="modal-close" id="usage-close">×</button>
            </div>
            <div class="modal-content">
                <div class="usage-tabs">
                    <button class="usage-tab active" data-tab="purchases">Purchases</button>
                    <button class="usage-tab" data-tab="usage">Usage Stats</button>
                </div>
                <div class="usage-tab-content">
                    <div class="usage-pane active" id="purchases-pane">
                        <div class="purchase-history" id="purchase-history">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="usage-pane" id="usage-pane">
                        <div class="usage-stats" id="usage-stats">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/main.js"></script>
</body>
</html>
