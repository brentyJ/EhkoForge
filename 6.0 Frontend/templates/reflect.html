{% extends "base.html" %}

{% block title %}EhkoForge — Reflect{% endblock %}

{% block area_styles %}
<link rel="stylesheet" href="/css/reflect.css">
{% endblock %}

{% block content %}
<aside class="sidebar reflect-sidebar">
    <!-- Sub-mode Tabs -->
    <div class="submode-tabs">
        <a href="/reflect/chat" class="submode-tab {% if submode == 'chat' %}is-active{% endif %}">
            <span class="submode-icon">◎</span>
            <span class="submode-label">Chat</span>
        </a>
        <a href="/reflect/journal" class="submode-tab {% if submode == 'journal' %}is-active{% endif %}">
            <span class="submode-icon">☰</span>
            <span class="submode-label">Journal</span>
        </a>
        <a href="/reflect/upload" class="submode-tab {% if submode == 'upload' %}is-active{% endif %}">
            <span class="submode-icon">↑</span>
            <span class="submode-label">Upload</span>
        </a>
    </div>
    
    <!-- Chat Mode Sidebar Content -->
    <div class="sidebar-content chat-sidebar-content {% if submode == 'chat' %}is-visible{% endif %}">
        <div class="sidebar-section-header">
            <span>Sessions</span>
        </div>
        <div class="sessions-list" id="sessions-list">
            <!-- Populated by JS -->
        </div>
        <button class="new-session-btn" id="new-session-btn">
            <span class="btn-icon">+</span>
            <span>New Session</span>
        </button>
    </div>
    
    <!-- Journal Mode Sidebar Content -->
    <div class="sidebar-content journal-sidebar-content {% if submode == 'journal' %}is-visible{% endif %}">
        <div class="calendar-nav">
            <button class="cal-nav-btn" id="cal-prev">◀</button>
            <span class="cal-month-label" id="cal-month-label">December 2025</span>
            <button class="cal-nav-btn" id="cal-next">▶</button>
        </div>
        <div class="calendar-grid" id="calendar-grid">
            <!-- Generated by JS -->
        </div>
        <div class="sidebar-section-header">
            <span>Entries This Month</span>
        </div>
        <div class="journal-entries-list" id="journal-entries-list">
            <!-- Populated by JS -->
        </div>
    </div>
    
    <!-- Upload Mode Sidebar Content -->
    <div class="sidebar-content upload-sidebar-content {% if submode == 'upload' %}is-visible{% endif %}">
        <div class="sidebar-section-header">
            <span>Upload Queue</span>
        </div>
        <div class="upload-queue-list" id="upload-queue-list">
            <div class="empty-queue">
                <p>No files queued</p>
            </div>
        </div>
        <div class="sidebar-section-header">
            <span>Recently Processed</span>
        </div>
        <div class="upload-recent-list" id="upload-recent-list">
            <!-- Populated by JS -->
        </div>
    </div>
    
    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
        <div class="ehko-state-sidebar" id="ehko-state-sidebar">
            <span class="state-icon">◇</span>
            <span class="state-text">Nascent</span>
        </div>
    </div>
</aside>

<main class="main-panel reflect-main">
    <!-- Ehko Avatar Zone -->
    <div class="avatar-zone" id="avatar-zone">
        <div class="avatar" id="avatar">
            <div class="avatar-core"></div>
        </div>
        <div class="avatar-status" id="avatar-status">Ready</div>
        <!-- Compact Stats Bar -->
        <div class="stats-bar-compact" id="stats-bar">
            <span class="stat-item" data-stat="identity_depth" title="Identity Depth">◇</span>
            <span class="stat-item" data-stat="clarity" title="Clarity">✦</span>
            <span class="stat-item" data-stat="resonance" title="Resonance">◎</span>
            <span class="stat-item" data-stat="anchors" title="Anchors">⚓</span>
        </div>
    </div>
    
    <!-- Chat Mode Content -->
    <div class="mode-content chat-content {% if submode == 'chat' %}is-visible{% endif %}">
        <div class="chat-messages" id="chat-messages">
            <div class="empty-state">
                <p>Begin a new session to start reflecting.</p>
                <p class="subtle">Your reflections become part of the Ehko.</p>
            </div>
        </div>
    </div>
    
    <!-- Journal Mode Content -->
    <div class="mode-content journal-content {% if submode == 'journal' %}is-visible{% endif %}">
        <div class="journal-view" id="journal-view">
            <div class="journal-empty">
                <p>Select a date to view or create an entry.</p>
                <p class="subtle">Your journal becomes part of your story.</p>
            </div>
        </div>
    </div>
    
    <!-- Upload Mode Content -->
    <div class="mode-content upload-content {% if submode == 'upload' %}is-visible{% endif %}">
        <div class="upload-zone">
            <h2>Upload Ore for Processing</h2>
            <div class="upload-dropzone" id="upload-dropzone">
                <div class="dropzone-content">
                    <span class="dropzone-icon">↑</span>
                    <p>Drag files here or click to browse</p>
                    <p class="dropzone-hint">Supported: .txt, .md, .json, .csv, images, audio</p>
                </div>
                <input type="file" id="file-input" multiple hidden>
            </div>
            <div class="upload-status" id="upload-status">
                <!-- Upload progress shown here -->
            </div>
        </div>
    </div>
    
    <!-- Input Bar (Chat mode only) -->
    <div class="input-bar {% if submode != 'chat' %}is-hidden{% endif %}" id="input-bar">
        <div class="input-glow"></div>
        <textarea 
            id="message-input" 
            placeholder="Share your thoughts..."
            rows="1"
        ></textarea>
        <button class="send-btn" id="send-btn" title="Send">
            <span class="send-icon">↵</span>
        </button>
    </div>
</main>

<!-- Forge Modal (for forging messages to vault) -->
<div class="forge-overlay" id="forge-overlay">
    <div class="forge-modal">
        <div class="forge-header">
            <h2>Forge to Vault</h2>
            <button class="close-forge" id="close-forge">×</button>
        </div>
        <div class="forge-content">
            <div class="forge-field">
                <label for="forge-title">Title</label>
                <input type="text" id="forge-title" placeholder="Name this reflection...">
            </div>
            <div class="forge-field">
                <label for="forge-tags">Tags (comma-separated)</label>
                <input type="text" id="forge-tags" placeholder="identity, memory, reflection">
            </div>
            <div class="forge-field">
                <label for="forge-emotional">Emotional Tags (comma-separated)</label>
                <input type="text" id="forge-emotional" placeholder="contemplative, hopeful">
            </div>
            <div class="forge-selection">
                <p>Messages to forge: <span id="forge-count">0</span></p>
            </div>
        </div>
        <div class="forge-actions">
            <button class="forge-cancel" id="forge-cancel">Cancel</button>
            <button class="forge-confirm" id="forge-confirm">
                <span class="forge-icon">◈</span>
                Forge
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block area_scripts %}
<script src="/js/reflect.js"></script>
{% if submode == 'journal' %}
<script src="/js/journal.js"></script>
{% endif %}
{% endblock %}
